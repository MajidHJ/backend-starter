According to a document from day_xx.md and Week 7 materials, today corresponds to **Day 48 â€” Dependency Injection (proper, not hard-coded)**.

---

# ğŸ“˜ Day 48 â€” Dependency Injection (Proper Wiring)

## ğŸ¯ Goals for Today

* Remove `service = UserService()` from routes
* Introduce proper Dependency Injection via `deps.py`
* Understand why global services break testability and state isolation
* Move toward a real composition root
* Prepare architecture for repository & database integration

---

## ğŸ§  What I Learned

* A route must **declare dependencies**, not construct them.

* `Depends()` works only in function signatures, not inside function bodies.

* Passing `Depends(get_storage())` is incorrect â€” it executes immediately.

* Correct pattern:

  ```python
  def get_user_service(storage = Depends(get_storage)):
      return UserService(storage)
  ```

* Global service instances make:

  * Testing difficult
  * State unpredictable
  * Future DB integration fragile

* Dependency graph must be explicit and composable:

  * Route â†’ Service
  * Service â†’ Storage (temporary in-memory)
  * Later: Service â†’ Repository â†’ DB Session

* Mutable default arguments (e.g., `def f(x=[])`) are dangerous and unclear.

* Shared in-memory storage should be explicit module-level state.

* Temporary use of `list[Any]` is acceptable until domain layer is introduced.

* DTO (`UserResponse`) should not be used as persistence model (architecture awareness).

* Proper DI today ensures repository pattern (Week 11) can be introduced without touching routes.

---

## ğŸ— Project Structure (Current)

```
app/
â”œâ”€â”€ api/
â”‚   â””â”€â”€ v1/
â”‚       â””â”€â”€ users.py        # routes (orchestration only)
â”‚
â”œâ”€â”€ application/
â”‚   â””â”€â”€ users/
â”‚       â”œâ”€â”€ service.py      # use-case logic
â”‚       â”œâ”€â”€ commands.py     # write DTOs
â”‚       â””â”€â”€ queries.py      # read DTOs
â”‚
â”œâ”€â”€ schemas/
â”‚   â”œâ”€â”€ user.py             # request/response models
â”‚   â””â”€â”€ common.py           # ErrorResponse, Page[T]
â”‚
â”œâ”€â”€ deps.py                 # composition root (DI wiring)
â”œâ”€â”€ settings.py
â””â”€â”€ main.py
```

---

## âœ… Architectural State After Day 48

* Routes perform orchestration only.
* Business logic lives in `application` layer.
* Commands and Queries are separated.
* Service is injected (not hard-created).
* Storage is injected (temporary, in-memory).
* Dependency direction is correct (API â†’ Application).
* Ready for:

  * Centralized exception handling (Week 8)
  * Repository abstraction
  * Database integration
  * Unit testing service independently

---

This day completes the structural foundation of Week 7 and prepares the project for production-grade layering in Month 3.
